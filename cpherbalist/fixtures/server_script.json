[
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 1,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-05-06 15:13:14.970816",
  "module": "Cpherbalist",
  "name": "EXCLUDED_ITEM_FROM_PRICING_RULE",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Sales Invoice Item",
  "script": "# List of item codes you want to exclude from the discount\nEXCLUDED_ITEMS = [\"ZL\"]\nDISCOUNT_PERCENTAGE = 0\nTARGET_WAREHOUSE = \"Central - Ithomis\"\nTARGET_POS_PROFILE = \"Ithomis\"\n\n# Check parent for POS Profile and Warehouse\nparent_doc = frappe.get_doc(\"Sales Invoice\", doc.parent)\n\nif (\n    doc.item_code not in EXCLUDED_ITEMS\n    and doc.warehouse == TARGET_WAREHOUSE\n    and parent_doc.pos_profile == TARGET_POS_PROFILE\n):\n    doc.discount_percentage = DISCOUNT_PERCENTAGE",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 1,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Submit",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-05-11 14:55:20.499788",
  "module": "Cpherbalist",
  "name": "Auto Write-Off",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "POS Invoice",
  "script": "THRESHOLD = 1.00\r\n\r\nif doc.is_pos and doc.outstanding_amount and abs(doc.outstanding_amount) <= THRESHOLD:\r\n    paid_to_account = None\r\n\r\n    if doc.payments and len(doc.payments) > 0:\r\n        paid_to_account = doc.payments[0].account\r\n\r\n    if paid_to_account:\r\n        pe = frappe.new_doc(\"Payment Entry\")\r\n        pe.payment_type = \"Receive\"\r\n        pe.posting_date = frappe.utils.nowdate()\r\n        pe.company = doc.company\r\n        pe.party_type = \"Customer\"\r\n        pe.party = doc.customer\r\n        pe.paid_to = paid_to_account\r\n        pe.paid_amount = doc.outstanding_amount\r\n        pe.received_amount = doc.outstanding_amount\r\n        pe.references = [{\r\n            \"reference_doctype\": doc.doctype,\r\n            \"reference_name\": doc.name,\r\n            \"total_amount\": doc.rounded_total or doc.grand_total,\r\n            \"outstanding_amount\": doc.outstanding_amount,\r\n            \"allocated_amount\": doc.outstanding_amount\r\n        }]\r\n        pe.append(\"deductions\", {\r\n            \"account\": frappe.db.get_single_value(\"CP Settings\", \"default_write_off_account\"),\r\n            \"cost_center\": doc.get(\"cost_center\") or frappe.db.get_value(\"Company\", doc.company, \"cost_center\"),\r\n            \"amount\": doc.outstanding_amount\r\n        })\r\n        pe.flags.ignore_permissions = True\r\n        pe.save()\r\n        pe.submit()\r\n",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 1,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Submit",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-05-20 15:59:05.582864",
  "module": null,
  "name": "POS INVOICE NAMING",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "POS Invoice",
  "script": "doc.name = 'PAID-.########'",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 1,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Submit",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-05-20 16:05:53.296327",
  "module": null,
  "name": "POS Invoice",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "POS Invoice",
  "script": "# Trigger: After Submit\n\nmake_autoname = frappe.get_attr(\"frappe.model.naming.make_autoname\")\n\n\nif doc.docstatus == 1 and not doc.name.startswith(\"POS-SUB-\"):\n    new_name = frappe.model.naming.make_autoname(\"POS-SUB-.#####\")\n    frappe.rename_doc(doc.doctype, doc.name, new_name, force=True)\n",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 1,
  "api_method": "coupon.create",
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-05-27 13:27:49.382834",
  "module": "Cpherbalist",
  "name": "Coupon Update API",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": null,
  "script": "frappe.log_error(f\"⚠️ [coupon.create] Coupon\", frappe.form_dict)\n\n# Call create coupon\n\nif not frappe.db.exists(\"Coupon Code\", frappe.form_dict.s_coupon_code):\n    coupon_code = frappe.get_doc(\n\t\t{\n\t\t\t\"doctype\": \"Coupon Code\",\n\t\t\t\"coupon_name\": frappe.form_dict.s_coupon_code,\n\t\t\t\"coupon_code\": frappe.form_dict.s_coupon_code,\n            \"description\": frappe.form_dict.s_description,\n\t\t\t\"maximum_use\": 1,\n\t\t\t\"used\": 0,\n            \"custom_amount\" : frappe.form_dict.f_custom_amount,\n            \"custom_woocommerce_coupon\": frappe.form_dict.s_wc_coupon_code,\n            \"customer\": \"Walkin Customer\",\n            \"coupon_type\": \"Gift Card\",\n            \"valid_upto\": frappe.form_dict.s_valid_upto\n\n\t\t})\n    coupon_code.insert()\n    frappe.response['message'] = \"ok\"",
  "script_type": "API"
 }
]